<?xml version = "1.0" encoding = "utf-8"?>
<html>
    <head>
        <meta charset="utf-8" />
        <title>餐廳訂餐系統</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script>
            $(document).ready(function () {
                $('[data-toggle="popover"]').popover();
            });
            function processFormData() {
				var customerName = document.getElementById("customerName").value;
				var restaurantName = document.getElementById("restaurantName").value;
			  	var hamburger = document.getElementById("hamburger").value;
			  	var frenchFries = document.getElementById("frenchFries").value;
			  	var milktea = document.getElementById("milktea").value;
			  	var content2={"hamburger":hamburger,"frenchFries":frenchFries,"milktea":milktea}
			  	var dataContent= {"customerName":customerName,"restaurantName":restaurantName,"orderContent":content2}
                $.ajax({
                    url: "http://localhost:8097/customer/addOrder",
                    type: "POST",
                    data:JSON.stringify(dataContent),
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: function (returnData) {
                        window.alert(
                            "你的名字是" + returnData.customerName + "\n餐廳是 " + returnData.restaurantName+"\n內容要 "+ returnData.orderContent
                        );
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    },
                });
			}
			function addOneOrder() {
				var customerName = document.getElementById("customerName").value;
				var restaurantName = document.getElementById("restaurantName").value;
			  	var hamburger = document.getElementById("hamburger").value;
			  	var frenchFries = document.getElementById("frenchFries").value;
			  	var milktea = document.getElementById("milktea").value;
			  	var content2={"hamburger":hamburger,"frenchFries":frenchFries,"milktea":milktea}
			  	var dataContent= {"customerName":customerName,"restaurantName":restaurantName,"orderContent":content2}
                $.ajax({
                    url: "http://localhost:8097/api/orders",
                    type: "POST",
                    data:JSON.stringify(dataContent),
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: function (returnData) {
                        window.alert(
                            "你的名字是" + returnData.customerName + "\n餐廳是 " + returnData.restaurantName+"\n內容要 "+ returnData.orderContent
                        );
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    },
                });
			}
			function checkOrder() {
				var customerName = document.getElementById("customerName").value;
                $.ajax({
                    url:"http://localhost:8097/customer/checkOrders/"+customerName,
                    contentType: "application/json;charset=utf-8",
                    type: "GET",
                    dataType: "json",
                    success: function (returnData) {
                        console.log(returnData);
                        tableContent=''
                        for (var i = 0; i < returnData.length; i++) {
                          tableContent += 
                                    `<tr>
                                        <td>${returnData[i].orderId}</td> 
                                        <td>${returnData[i].restaurantName}</td>
                                        <td>${returnData[i].customerName}</td>
                                        <td>${returnData[i].orderTime}</td>
                                        <td>
                                          漢堡: ${returnData[i].orderContent.hamburger}<br>
                                          薯條: ${returnData[i].orderContent.frenchFries}<br>
                                          奶茶: ${returnData[i].orderContent.milktea}
                                        </td>
                                        <td><button class="btn btn-primary" onclick="confirmOrder(${i})">確認</button></td>
                                    </tr>`;
                        }
                        $('#myTable').html(tableContent)
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    },
                });
			}
        </script>
    </head>

    <body>
        <div class="container">
            <h2>海洋大學學餐菜單</h2>
            <form action="#">
                <div class="form-group">
                	<label for="usr1">顧客姓名:</label>
                    <input type="text" class="form-control" id="customerName" value="0" />
                    <br />
                    <label for="sel1">選擇餐廳:</label>
                    <select class="form-control" id="restaurantName" name="sellist1">
                        <option>麥當勞</option>
                        <option>肯德基</option>
                        <option>漢堡王</option>
                    </select>
                    <br />
                    <label for="hamburger">輸入漢堡數量:</label>
                    <input type="number" class="form-control" id="hamburger" value="0" min="0"/>
                    <br />
                    <label for="frenchFries">輸入薯條數量:</label>
                    <input type="number" class="form-control" id="frenchFries" value="0" min="0"/>
                    <br />
                    <label for="milktea">輸入奶茶數量:</label>
                    <input type="number" class="form-control" id="milktea" value="0" min="0"/>
                </div>
                <button type="submit" class="btn btn-primary" onclick="addOneOrder();">加入購物車</button>
                <button type="submit" class="btn btn-primary">清除購物車</button>
                <button type="button" class="btn btn-primary" data-toggle="modal" onclick="processFormData();">送出訂單</button>
                <!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">送出訂單</button>-->
            </form>
        </div>

        <!-- The Modal -->
        <div class="modal fade" id="myModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Modal Heading</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">Modal body..</div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <a href="#" data-toggle="popover" title="購物車內容" data-content="沒有東西">購物車</a>
            
            <!--$('[data-toggle="popover"]').attr('有東西'); -->
        </div>
        <hr />
        
        <div class="container">
            <button type="button" class="btn btn-primary" onclick="checkOrder();">查看歷史訂單</button>
        </div>
        <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>訂單編號</th>
                    <th>餐廳名稱</th>
                    <th>姓名</th>
                    <th>訂單時間</th>
                    <th>訂單內容</th>
                    <th>確認訂單</th>
                  </tr>
                </thead>
                <tbody id="myTable">
                 
                </tbody>
        </table>
    </body>
</html>
